{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-location",
  "type": "registry:hook",
  "files": [
    {
      "path": "registry/default/hooks/use-location.ts",
      "content": "import { useState, useEffect } from \"react\";\r\n\r\ninterface Coordinates {\r\n  lat: number;\r\n  lon: number;\r\n}\r\n\r\ninterface LocationData {\r\n  coordinates: Coordinates | null;\r\n  city: string | null;\r\n  error: string | null;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst DEFAULT_LOCATION: Coordinates = {\r\n  lat: 19.076, // Mumbai\r\n  lon: 72.8777,\r\n};\r\n\r\nconst CACHE_KEY = \"wigggle-location-data\";\r\nconst CACHE_EXPIRY = 3600 * 1000;\r\n\r\ninterface CacheData {\r\n  coordinates: Coordinates;\r\n  city: string;\r\n  timestamp: number;\r\n}\r\n\r\nexport function useLocation(): LocationData {\r\n  const [coordinates, setCoordinates] = useState<Coordinates | null>(null);\r\n  const [city, setCity] = useState<string | null>(null);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState<boolean>(true);\r\n\r\n  useEffect(() => {\r\n    const checkCacheAndFetch = async () => {\r\n      // 1. Check LocalStorage Cache\r\n      const cached = localStorage.getItem(CACHE_KEY);\r\n      if (cached) {\r\n        try {\r\n          const parsedCache: CacheData = JSON.parse(cached);\r\n          const now = Date.now();\r\n          if (now - parsedCache.timestamp < CACHE_EXPIRY) {\r\n            setCoordinates(parsedCache.coordinates);\r\n            setCity(parsedCache.city);\r\n            setIsLoading(false);\r\n            return;\r\n          }\r\n        } catch (e) {\r\n          console.error(\"Failed to parse location cache\", e);\r\n          localStorage.removeItem(CACHE_KEY);\r\n        }\r\n      }\r\n\r\n      // 2. Helper to save cache\r\n      const saveToCache = (coords: Coordinates, cityName: string) => {\r\n        const cacheData: CacheData = {\r\n          coordinates: coords,\r\n          city: cityName,\r\n          timestamp: Date.now(),\r\n        };\r\n        localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));\r\n      };\r\n\r\n      // 3. Try Browser Geolocation\r\n      if (!navigator.geolocation) {\r\n        fallbackToIP(\"Geolocation not supported\");\r\n        return;\r\n      }\r\n\r\n      navigator.geolocation.getCurrentPosition(\r\n        async (position) => {\r\n          const { latitude, longitude } = position.coords;\r\n          const coords = { lat: latitude, lon: longitude };\r\n\r\n          let cityName = \"Unknown Location\";\r\n          try {\r\n            const response = await fetch(\r\n              `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${latitude}&longitude=${longitude}&localityLanguage=en`,\r\n            );\r\n            const data = await response.json();\r\n            cityName = data.city || data.locality || \"Unknown Location\";\r\n          } catch (err) {\r\n            console.error(\"Failed to fetch city name:\", err);\r\n          }\r\n\r\n          setCoordinates(coords);\r\n          setCity(cityName);\r\n          saveToCache(coords, cityName);\r\n          setIsLoading(false);\r\n        },\r\n        (err) => {\r\n          console.warn(\r\n            \"Geolocation failed, attempting IP fallback:\",\r\n            err.message,\r\n          );\r\n          fallbackToIP(err.message);\r\n        },\r\n      );\r\n\r\n      // 4. IP Fallback Strategy\r\n      async function fallbackToIP(initialError: string) {\r\n        try {\r\n          const response = await fetch(\"https://ipwho.is/\");\r\n          const data = await response.json();\r\n\r\n          if (data.success) {\r\n            const coords = { lat: data.latitude, lon: data.longitude };\r\n            const cityName = data.city || data.region || \"Unknown Location\";\r\n\r\n            setCoordinates(coords);\r\n            setCity(cityName);\r\n            setError(null);\r\n            saveToCache(coords, cityName);\r\n          } else {\r\n            throw new Error(data.message || \"IP Geolocation failed\");\r\n          }\r\n        } catch (ipErr) {\r\n          console.error(\"IP Geolocation failed, defaulting to Mumbai:\", ipErr);\r\n          setError(initialError);\r\n          setCoordinates(DEFAULT_LOCATION);\r\n          setCity(\"Mumbai\");\r\n        } finally {\r\n          setIsLoading(false);\r\n        }\r\n      }\r\n    };\r\n\r\n    checkCacheAndFetch();\r\n  }, []);\r\n\r\n  return { coordinates, city, error, isLoading };\r\n}\r\n",
      "type": "registry:hook"
    }
  ]
}